<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10.5. Studio: Deploy CodingEventsAPI to Windows Server &amp; IIS &#8212; Microsoft Azure  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11. Introduction to Troubleshooting" href="../troubleshooting-next-steps/index.html" />
    <link rel="prev" title="10.4. Walkthrough: Windows Server &amp; IIS Starter App Deployment" href="walkthrough_ws-iis.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
   <div class="container">
     <div class="navbar-header">
       <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </button>
       <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
       </a>
       <span class="navbar-text navbar-version pull-left"><b></b></span>
     </div>

       <div class="collapse navbar-collapse nav-collapse">
         <ul class="nav navbar-nav">
           
           
             
           
           
           
           
           
         </ul>

         
           
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
         
       </div>
   </div>
 </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html">10. Windows Server &amp; IIS</a></li>
    <li class="active">10.5. Studio: Deploy CodingEventsAPI to Windows Server &amp; IIS</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content ">

    
  <div class="section" id="studio-deploy-codingeventsapi-to-windows-server-iis">
<h1>10.5. Studio: Deploy CodingEventsAPI to Windows Server &amp; IIS<a class="headerlink" href="#studio-deploy-codingeventsapi-to-windows-server-iis" title="Permalink to this headline">¶</a></h1>
<p>In today’s studio you will practice deploying the Coding Events API to a Windows Server VM. You will be using the <code class="docutils literal notranslate"><span class="pre">az</span> <span class="pre">CLI</span></code> and the new Windows Server tools that you learned about.</p>
<p>While this studio will be challenging, do your best to complete the tasks on your own by referring to your notes and previous lessons. If you are completely stuck, then reach out to a TA or your instructor for help.</p>
<p>We will provide some high-level planning and guidance for new steps you haven’t seen before. Otherwise, you are on your own to complete the mission. Good luck!</p>
<div class="section" id="checklist">
<h2>10.5.1. Checklist<a class="headerlink" href="#checklist" title="Permalink to this headline">¶</a></h2>
<p>This studio will be considered complete when the Swagger documentation page of your Coding Events API is accessible over <code class="docutils literal notranslate"><span class="pre">https</span></code> at the public IP address of the host VM. You will be deploying the same (final) version of the API on the <code class="docutils literal notranslate"><span class="pre">3-aadb2c</span></code> branch.</p>
<p>Feel free to use Postman to confirm functionality, but the main purpose of this studio is to deploy to a Windows Server VM using the IIS web server, not to practice with Postman.</p>
<p>The following is a checklist of tasks you will need to complete. This list is neither exhaustively detailed nor necessarily in a specific order:</p>
<ul class="simple">
<li>Provision a Windows Server VM</li>
<li>Provision and configure a Key Vault with the database connection string secret</li>
<li>Install and configure IIS to host .NET web app sites</li>
<li>Configure the hosting environment for the API</li>
<li>Update your <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> after provisioning resources</li>
<li>Deliver and publish the API to a directory for IIS to serve</li>
<li>Configure IIS to serve the API over <code class="docutils literal notranslate"><span class="pre">https</span></code></li>
</ul>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>You can provision and configure your resources by any approach you prefer. However, this is a great opportunity to write new scripts for the aspects you are familiar with automating.</p>
<p class="last">While we have shown some of the VM configuration steps using the GUI applications on Windows Server, it is <em>technically possible</em> to automate all of it with PowerShell scripts. Focus on manually completing the studio <em>first</em>, then challenge yourself to fully automate the deployment!</p>
</div>
</div>
<div class="section" id="planning">
<h2>10.5.2. Planning<a class="headerlink" href="#planning" title="Permalink to this headline">¶</a></h2>
<p>Windows and Linux have many fundamental differences between them that stem from their contrasting kernel designs. But in the context of a host machine for web apps, the choice of OS is largely arbitrary. The tools and techniques may differ, but they both share OS-agnostic requirements that are dictated by the application itself. We refer to these requirements as the application’s <strong>hosting environment</strong> needs.</p>
<p>Let’s consider the general requirements that our API has on its hosting environment:</p>
<ol class="arabic simple">
<li><strong>Runtime</strong>: the .NET SDK (and included runtime) is needed to <code class="docutils literal notranslate"><span class="pre">publish</span></code> and execute our API’s artifact</li>
<li><strong>Delivery</strong>: <code class="docutils literal notranslate"><span class="pre">git</span></code> is used as our tool for delivering (cloning and publishing) the artifact to the VM</li>
<li><strong>MySQL database</strong>: our API relies on an embedded (in the same machine) MySQL database server as a backing service</li>
<li><strong>Web server</strong>: we need an external web server (like IIS) to serve our application more efficiently and securely than the built-in Kestrel web server</li>
<li><strong>HTTPS</strong>: our API must be served over a secure connection to use ADB2C; it needs an SSL certificate and a way of performing TLS termination using that certificate</li>
</ol>
</div>
<div class="section" id="limited-guidance">
<h2>10.5.3. Limited Guidance<a class="headerlink" href="#limited-guidance" title="Permalink to this headline">¶</a></h2>
<p>The following sections will guide you on specifics and steps you may not have seen yet. Before starting the studio take a moment to read them over and come up with a plan for when and how you will use them.</p>
<div class="admonition-tip admonition">
<p class="first admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p class="last">Don’t forget to look over the <em>Gotchas</em> section at the end for a heads-up on common mistakes!</p>
</div>
<div class="section" id="packages">
<h3>10.5.3.1. Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h3>
<p>Many of these requirements can be satisfied by using a package manager. On Windows Server, we use the chocolatey package manager (<code class="docutils literal notranslate"><span class="pre">choco</span></code>). Refer to previous lessons if you need a refresher on how to install chocolatey.</p>
<p>The packages you need to install with <code class="docutils literal notranslate"><span class="pre">choco</span></code> have the following names:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">dotnetcore-sdk</span></code>: the latest SDK and the <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">CLI</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">mysql</span></code>: the latest MySQL database server and its companion tool the <code class="docutils literal notranslate"><span class="pre">mysql</span> <span class="pre">CLI</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">git</span></code>: the latest Git version control system</li>
<li><code class="docutils literal notranslate"><span class="pre">dotnetcore-windowshosting</span></code>: the latest IIS hosting bundle for serving .NET core Web Apps</li>
</ul>
<p>Recall that the general form of using <code class="docutils literal notranslate"><span class="pre">choco</span></code> is:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="n">choco</span> <span class="n">install</span> <span class="p">&lt;</span><span class="n">package</span> <span class="n">name</span><span class="p">&gt;</span> <span class="n">-y</span>
</pre></div>
</div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">When installing MySQL you may see a lot of red-colored output. Despite red typically meaning <em>something has gone horribly wrong</em> there is nothing to be concerned about. Let it finish installing then, like the <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">CLI</span></code> installation, close and reopen PowerShell to start using it.</p>
</div>
</div>
<div class="section" id="mysql-setup">
<h3>10.5.3.2. MySQL Setup<a class="headerlink" href="#mysql-setup" title="Permalink to this headline">¶</a></h3>
<p>The MySQL database server will start up on its own after installation through <code class="docutils literal notranslate"><span class="pre">choco</span></code>. However, you will need to configure the Coding Events database within the MySQL server for your API to connect to and use. In the Linux deployment this was handled automatically through the setup scripts we ran. This time you will need to use the <code class="docutils literal notranslate"><span class="pre">mysql</span> <span class="pre">CLI</span></code> to set up the database, user and permissions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mysql</span> <span class="pre">CLI</span></code> will open a connection to the database server and start a MySQL shell session. This shell, like the Bash or PowerShell command-line shells, is a REPL where you can enter commands and see print result output. However, unlike the scripting shells, the MySQL shell naturally only accepts MySQL syntax.</p>
<p>You can open the MySQL shell by issuing the following command from the PowerShell terminal in the VM:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell, connect as the root user to set up the database</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="n">mysql</span> <span class="n">-u</span> <span class="n">root</span>
</pre></div>
</div>
</div>
<p>Once inside the MySQL shell you can enter the following commands to set up the database and user. Then use the <code class="docutils literal notranslate"><span class="pre">exit</span></code> command to quit the MySQL shell and return to the PowerShell shell:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">MySQL shell, each command should be entered individually</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">coding_events</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="k">CREATE</span> <span class="n">USER</span> <span class="s1">&#39;coding_events&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;launchcode&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="k">GRANT</span> <span class="k">ALL</span> <span class="n">PRIVILEGES</span> <span class="k">ON</span> <span class="n">coding_events</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;coding_events&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="k">FLUSH</span> <span class="n">PRIVILEGES</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="k">exit</span>
</pre></div>
</div>
</div>
<p>Now confirm everything was set up correctly by connecting to the database with the new user. You will be prompted to enter the password (<code class="docutils literal notranslate"><span class="pre">launchcode</span></code>):</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="n">mysql</span> <span class="n">-u</span> <span class="n">coding_events</span> <span class="n">-D</span> <span class="n">coding_events</span> <span class="n">-p</span>
</pre></div>
</div>
</div>
<p>If this command connects to the MySQL <code class="docutils literal notranslate"><span class="pre">coding_events</span></code> database you will know the previous commands executed successfully. From the MySQL shell enter <code class="docutils literal notranslate"><span class="pre">exit</span></code> and hit enter to return to PowerShell.</p>
</div>
<div class="section" id="configuring-https-with-iis">
<h3>10.5.3.3. Configuring HTTPS with IIS<a class="headerlink" href="#configuring-https-with-iis" title="Permalink to this headline">¶</a></h3>
<p>Since this deployment uses a Windows Server VM we are able to use the native IIS web server. Refer to the previous walkthrough article for the details of how to install and configure it to serve a .NET web app.</p>
<p>In this deployment, we will have to perform one additional step—provisioning an SSL certificate and configuring IIS to use that certificate to serve over <code class="docutils literal notranslate"><span class="pre">https</span></code>. Fortunately, IIS makes it easy to provision and use a self-signed certificate using the IIS Manager.</p>
<div class="admonition-tip admonition">
<p class="first admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p class="last">In a production deployment you would use an SSL certificate signed by an established Certificate Authority (CA). The topic of <a class="reference external" href="https://www.ssh.com/pki/" target="_blank">Public Key Infrastructure (PKI)<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>, which SSL certificates belong to, is beyond the scope of this class. For our purposes, the self-signed certificate is a suitable alternative.</p>
</div>
<div class="section" id="provision-a-self-signed-certificate">
<h4>10.5.3.3.1. Provision a Self-signed Certificate<a class="headerlink" href="#provision-a-self-signed-certificate" title="Permalink to this headline">¶</a></h4>
<p>From the IIS manager:</p>
<ol class="arabic simple">
<li>Select the VM from the <em>Connections</em> panel on the left</li>
<li>Switch to the <em>Features</em> View (at the bottom of the window)</li>
<li>From the <em>Features</em> View select <em>Server Certificates</em></li>
</ol>
<img alt="IIS Manager VM Features View server certificates selection" src="../../_images/iis-manager-server-certs.png" />
<p>On the right side select the option to create a new self-signed certificate:</p>
<img alt="IIS Manager create self-signed certificate option" src="../../_images/iis-manager-self-signed-cert.png" />
<p>In the dialog box, set the following options for the name and store the certificate will be held in:</p>
<img alt="IIS Manager self-signed certificate creation wizard" src="../../_images/iis-manager-create-self-signed-cert.png" />
<p>This will create the self-signed certificate and store it for use in web hosting. Now you just need to assign the certificate to your site.</p>
</div>
<div class="section" id="configure-the-site-to-be-served-securely">
<h4>10.5.3.3.2. Configure the Site to be Served Securely<a class="headerlink" href="#configure-the-site-to-be-served-securely" title="Permalink to this headline">¶</a></h4>
<p>When you configure the port binding of the site there is an option to set the server certificate to be used. This option is <em>only available</em> for a binding to <code class="docutils literal notranslate"><span class="pre">https</span></code> (port 443). Just as before, you can right click the site and select the edit bindings option then add an additional binding for <code class="docutils literal notranslate"><span class="pre">https</span></code>.</p>
<p>In the binding dialog, select <code class="docutils literal notranslate"><span class="pre">https</span></code> and the certificate you provisioned in the previous steps:</p>
<img alt="IIS Manager Site binding to https" src="../../_images/iis-manager-site-https-binding.png" />
<p>After setting the binding we want to enforce the use of SSL by forbidding any insecure requests. In the <em>Site Features</em> view select <em>SSL Settings</em> then <em>Require SSL</em> and <em>Apply</em> (in the top right corner):</p>
<img alt="IIS Manager Server Features View SSL settings" src="../../_images/iis-manager-site-ssl-settings.png" />
<img alt="IIS Manager require SSL setting" src="../../_images/iis-manager-site-require-ssl.png" />
<p>Finally, you can enable HTTP Strict Transport Security (HSTS) which will notify browsers to prevent access over <code class="docutils literal notranslate"><span class="pre">http</span></code>. We will also select the option for automatically upgrading from <code class="docutils literal notranslate"><span class="pre">http</span></code> to <code class="docutils literal notranslate"><span class="pre">https</span></code> to support this configuration. In the <em>Site Features</em> view, the right-hand panel has an option for configuring HSTS. Open this dialog to enable it:</p>
<img alt="IIS Manager configure HSTS" src="../../_images/iis-manager-configure-hsts.png" />
<img alt="IIS Manager HSTS configuration dialog" src="../../_images/iis-manager-hsts-dialog.png" />
</div>
<div class="section" id="connecting-over-https">
<h4>10.5.3.3.3. Connecting Over HTTPS<a class="headerlink" href="#connecting-over-https" title="Permalink to this headline">¶</a></h4>
<p>The first time you connect to the site from a browser within the server or locally from your machine you will be presented with a warning. Because the server is using an untrusted (self-signed) certificate you need to explicitly accept its use:</p>
<p>From IE within the server:</p>
<img alt="Untrusted certificate warning in IE" src="../../_images/untrusted-certificate-ie.png" />
<p>From your local machine’s browser (Firefox):</p>
<img alt="Untrusted certificate warning in Firefox" src="../../_images/untrusted-certificate-firefox.png" />
<p>After accepting the certificate your site will be served over <code class="docutils literal notranslate"><span class="pre">https</span></code>!</p>
</div>
</div>
</div>
<div class="section" id="gotchas">
<h2>10.5.4. Gotchas<a class="headerlink" href="#gotchas" title="Permalink to this headline">¶</a></h2>
<p>Along the way there are a few “gotchas” that you should keep in mind to save yourself some headaches.</p>
<div class="section" id="installing-choco">
<h3>10.5.4.1. Installing <code class="docutils literal notranslate"><span class="pre">choco</span></code><a class="headerlink" href="#installing-choco" title="Permalink to this headline">¶</a></h3>
<p>The commands to install the Chocolatey package manager are rather involved. Below is the snippet from the walkthrough you can use:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="p">=</span> <span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="o">-bor</span> <span class="n">3072</span><span class="p">;</span> <span class="nb">iex </span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing-the-dotnetcore-windowshosting-bundle">
<h3>10.5.4.2. Installing the <code class="docutils literal notranslate"><span class="pre">dotnetcore-windowshosting</span></code> bundle<a class="headerlink" href="#installing-the-dotnetcore-windowshosting-bundle" title="Permalink to this headline">¶</a></h3>
<div class="admonition-warning admonition">
<p class="first admonition-title"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i>Warning</p>
<p class="last">As noted in the walkthrough, this bundle must be installed <em>after installing IIS</em>.</p>
</div>
<p>Below are the relevant instructions from the walkthrough.</p>
<p>Installing the .NET hosting bundle:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="n">choco</span> <span class="n">install</span> <span class="n">dotnetcore-windowshosting</span> <span class="n">-y</span>
</pre></div>
</div>
</div>
<p>Restart the underlying processes used by IIS to recognize and use the hosting bundle:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="c"># /y is like -y and is used to skip a confirmation prompt</span>

<span class="c"># when WAS is stopped it automatically stops all dependent processes including W3SVC</span>
<span class="p">&gt;</span> <span class="n">net</span> <span class="n">stop</span> <span class="n">WAS</span> <span class="p">/</span><span class="n">y</span>

<span class="c"># when W3SVC is started it starts its WAS process dependency automatically</span>
<span class="p">&gt;</span> <span class="n">net</span> <span class="nb">start </span><span class="n">W3SVC</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aadb2c-settings">
<h3>10.5.4.3. AADB2C Settings<a class="headerlink" href="#aadb2c-settings" title="Permalink to this headline">¶</a></h3>
<p>If you destroyed your AADB2C tenant after completing the previous exercises you have two choices:</p>
<ol class="arabic simple">
<li>Create a new AADB2C tenant</li>
<li>Use the demo AADB2C tenant settings</li>
</ol>
<p>The first choice is to configure a new one from scratch. While this might not sound very appealing it will allow you to get more practice and solidify your understanding of AADB2C. You will be surprised by how much smoother the experience is when doing it for the second time. It should only take you about 10 minutes if you go through it methodically and you can always refer to the walkthroughs as a reference.</p>
<p>Alternatively, you can use the following settings from the demo tenant we have provided.</p>
<p>For the entries in <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code>:</p>
<ul class="simple">
<li><strong>MetadataAddress</strong>: <code class="docutils literal notranslate"><span class="pre">https://launchcodeazurecourse.b2clogin.com/launchcodeazurecourse.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1_susi-flow</span></code></li>
<li><strong>Audience</strong>: <code class="docutils literal notranslate"><span class="pre">3bd03224-2365-4587-b3ab-7d2bdfcb222e</span></code></li>
</ul>
<p>For the Postman access token settings, you can leave what you currently have and update the following fields:</p>
<ul class="simple">
<li><strong>Client ID</strong>: <code class="docutils literal notranslate"><span class="pre">b1f6c144-0776-4645-a3da-4282cfff2ee1</span></code></li>
<li><strong>Scopes</strong>: <code class="docutils literal notranslate"><span class="pre">https://launchcodeazurecourse.onmicrosoft.com/3bd03224-2365-4587-b3ab-7d2bdfcb222e/user_impersonation</span></code></li>
<li><strong>Auth URL</strong>: <code class="docutils literal notranslate"><span class="pre">https://launchcodeazurecourse.b2clogin.com/launchcodeazurecourse.onmicrosoft.com/oauth2/v2.0/authorize?p=b2c_1_susi-flow</span></code></li>
</ul>
</div>
<div class="section" id="updating-the-serverorigin-keyvaultname">
<h3>10.5.4.4. Updating the <code class="docutils literal notranslate"><span class="pre">ServerOrigin</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">KeyVaultName</span></code><a class="headerlink" href="#updating-the-serverorigin-keyvaultname" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ServerOrigin</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyVaultName</span></code> entries in your <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> also need to be updated with the values relating to this new deployment. You can either:</p>
<ul class="simple">
<li><em>Update and commit</em> these changes in your deployment script</li>
<li>Manually update them <em>after delivery to the VM</em> using Notepad.</li>
</ul>
<div class="admonition-tip admonition">
<p class="first admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p>If you want to automate these updates in your script, consider that <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> is <em>just a JSON file</em> which can easily be updated, committed and pushed using PowerShell and <code class="docutils literal notranslate"><span class="pre">git</span></code>.</p>
<p>Refer to the PowerShell chapter and your notes for how to:</p>
<ol class="last arabic simple">
<li>Capture the VM public IP and Key Vault name in variables</li>
<li>Load the <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> file into a <code class="docutils literal notranslate"><span class="pre">PSCustomObject</span></code></li>
<li>Access and update the <code class="docutils literal notranslate"><span class="pre">ServerOrigin</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyVaultName</span></code> properties of the object using the variable values</li>
<li>Write the new state of the object back to the <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> file</li>
<li>Commit and push using <code class="docutils literal notranslate"><span class="pre">git</span></code></li>
</ol>
</div>
</div>
</div>
<div class="section" id="deliverable">
<h2>10.5.5. Deliverable<a class="headerlink" href="#deliverable" title="Permalink to this headline">¶</a></h2>
<p>For this studio, you will only need to provide your TA with your <em>secure</em> (<code class="docutils literal notranslate"><span class="pre">https</span></code>) public IP address.</p>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="walkthrough_ws-iis.html"><span aria-hidden="true">&larr;</span> 10.4. Walkthrough: Windows Server &amp; IIS Starter App Deployment</a></li>
        
        
        <li class="next"><a href="../troubleshooting-next-steps/index.html">11. Introduction to Troubleshooting <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/ws-iis/studio_ws-deployment.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>