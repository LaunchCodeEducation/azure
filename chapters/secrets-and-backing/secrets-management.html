<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>6.1. Secrets Management &#8212; Microsoft Azure  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.2. Application Environments" href="application-environments.html" />
    <link rel="prev" title="6. Secrets Management &amp; Backing Services" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
   <div class="container">
     <div class="navbar-header">
       <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </button>
       <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
       </a>
       <span class="navbar-text navbar-version pull-left"><b></b></span>
     </div>

       <div class="collapse navbar-collapse nav-collapse">
         <ul class="nav navbar-nav">
           
           
             
           
           
           
           
           
         </ul>

         
           
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
         
       </div>
   </div>
 </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html">6. Secrets Management &amp; Backing Services</a></li>
    <li class="active">6.1. Secrets Management</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content ">

    
  <div class="section" id="secrets-management">
<h1>6.1. Secrets Management<a class="headerlink" href="#secrets-management" title="Permalink to this headline">¶</a></h1>
<p>Modern web applications rely on access to one or more data sources. Most applications will need to make a request to at least one database to manage business data. To do this, the application needs credentials to access the database. Such credentials can be written as a database connection string.</p>
<div class="admonition-example admonition">
<p class="first admonition-title"><i class="fas fa-binoculars" aria-hidden="true"></i>Example</p>
<p>Consider the following fictionalized database connection string used to connect a .NET web application to a MySQL database:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>server=172.28.162.111;port=3306;database=car_db;user=car_user;password=7p*RTY5g8i#WB@F8
</pre></div>
</div>
</div>
<p>This string contains:</p>
<ul class="simple">
<li>The IP address of the database server</li>
<li>The port of the database server</li>
<li>A database name</li>
<li>A username and password that has access to the database</li>
</ul>
<p>That’s all the information anyone needs to gain access to your database server!</p>
<p id="index-0">A database connection string is a type of <strong>secret</strong>, a privileged piece of information that our application needs to operate.</p>
<p id="index-1">Secrets can be used as the key to protect access to <strong>sensitive data</strong>. Sensitive data includes proprietary knowledge or Personally Identifying Information (PII). Sensitive data is usually secured within a data backing service. The data backing service credentials (i.e. the database connection string) should be guarded to ensure only individuals with authorization can access this sensitive data.</p>
<p>Here are some examples of PII:</p>
<ul class="simple">
<li>First &amp; last name</li>
<li>Email address</li>
<li>Residential address</li>
<li>Phone number</li>
<li>Zip code</li>
<li>SSN</li>
</ul>
<p>Examples of Proprietary data:</p>
<ul class="simple">
<li>User habits, behaviors, and trends</li>
<li>Information about internal products or processes</li>
<li>Results of internal research</li>
<li>Patented or copyrighted materials</li>
</ul>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">A secret is a subset of sensitive data. Proprietary knowledge and PII may be part of the underlying data an application uses, but they are not <em>necessary</em> for an application to function.</p>
</div>
<div class="section" id="secrets">
<h2>6.1.1. Secrets<a class="headerlink" href="#secrets" title="Permalink to this headline">¶</a></h2>
<p id="index-2"><strong>Secrets</strong> are data kept separate from the source code of the application. In other words, a secret is information that is never made publicly available.</p>
<p>Examples of secrets:</p>
<ul class="simple">
<li>Databases connection strings</li>
<li>API keys</li>
<li>Usernames</li>
<li>Passwords</li>
<li>VM IP addresses</li>
</ul>
<div class="section" id="handling-sensitive-data">
<h3>6.1.1.1. Handling Sensitive Data<a class="headerlink" href="#handling-sensitive-data" title="Permalink to this headline">¶</a></h3>
<p>There are a few things we must do to ensure our sensitive data is not exposed to the public.</p>
<ul class="simple">
<li>Sensitive data stays out of version control</li>
<li>Application secrets are stored externally (i.e. separately from the app) and loaded at runtime</li>
<li>Infrastructure must be configured to grant least-privileged access</li>
<li>All PII and proprietary data is securely housed and requires authorization</li>
</ul>
<div class="admonition-warning admonition">
<p class="first admonition-title"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i>Warning</p>
<p class="last">This and the next two articles will talk about various strategies and tooling to keep sensitive data protected, but they are not exhaustive.</p>
</div>
<div class="section" id="vcs">
<h4>6.1.1.1.1. VCS<a class="headerlink" href="#vcs" title="Permalink to this headline">¶</a></h4>
<p>To ensure we don’t accidentally expose sensitive data we must be careful with the files we track using Git. If we have a file that contains sensitive data, we need to make sure the file is never staged and committed to a Git repository. If sensitive data is tracked, committed, and pushed to a remote repository then other people may be able to view it.</p>
<p>Manually determining which file has sensitive data and making sure it isn’t added to the local Git repository would be a pain. Fortunately for us, Git has a built in feature that allows us to easily track the files we don’t want to include in a repository.</p>
<p>This feature is managed by the aptly name <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file. Files and directories added to the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file will simply be skipped over when Git checks your files and directories for changes.</p>
<p>Let’s make a new temporary directory, initialize it as a local <code class="docutils literal notranslate"><span class="pre">git</span></code> repository and run the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code> command.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; New-Item -ItemType &quot;directory&quot; -Name temp_directory
&gt; Set-Location ./temp_directory/
&gt; New-Item -ItemType &quot;file&quot; -Name new-file.txt -Value &quot;hello world&quot;
&gt; git init
&gt; git status

On branch master

No commits yet

Untracked files:
(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
   new-file.txt

nothing added to commit but untracked files present (use &quot;git add&quot; to track)
</pre></div>
</div>
</div>
<p>After running these commands, the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code> output shows the <em>untracked</em> files. In this case, our untracked file is <code class="docutils literal notranslate"><span class="pre">new-file.txt</span></code>.</p>
<p>Let’s try adding a <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file with the entry of <code class="docutils literal notranslate"><span class="pre">new-file.txt</span></code> and the run the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code> again.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; Set-Location ./temp_directory/
&gt; New-Item -ItemType &quot;file&quot; -Name .gitignore -Value &quot;new-file.txt&quot;
&gt; git status

     On branch master

     No commits yet

     Untracked files:
     (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
             .gitignore

     nothing added to commit but untracked files present (use &quot;git add&quot; to track)
</pre></div>
</div>
</div>
<p>Our local Git repository has detected a different change. It no longer detects <code class="docutils literal notranslate"><span class="pre">new-file.txt</span></code>. In this case, Git simply skipped over <code class="docutils literal notranslate"><span class="pre">new-file.txt</span></code> when scanning our project directory since it matched an entry in the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file.</p>
<p>Our local Git repository has detected that a new file is currently untracked: <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>. We want to stage and commit this file because we can use it to document which files are not being tracked by Git.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; git add .gitignore
&gt; git commit -m &quot;added .gitignore to protect sensitive data&quot;
</pre></div>
</div>
</div>
<div class="admonition-tip admonition">
<p class="first admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p class="last">When writing code, you should always consider the data that is exposed in your source code. A best practice is to add a file (or a directory of files) to <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> that you know will contain sensitive data. By adding it before creating the file you can ensure secrets won’t ever have a chance to be committed. If you determine a file <em>does</em> have sensitive data in it then you should add it to the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file right away.</p>
</div>
<p>We have only scratched the surface of <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>. It is also used to ignore entire directories or derived code like build artifacts. It also understands wildcard syntax along with many other features. These aspects go beyond the scope of this course, but you can learn more by reading the <a class="reference external" href="https://git-scm.com/docs/gitignore" target="_blank">Git documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
</div>
<div class="section" id="external-configuration">
<h4>6.1.1.1.2. External Configuration<a class="headerlink" href="#external-configuration" title="Permalink to this headline">¶</a></h4>
<p id="index-3">A best practice for handling secrets is to use <strong>external configuration</strong> files. In the same vein as keeping sensitive data out of our source code, external configuration goes a step further by keeping our configuration files outside of our project file tree.</p>
<p>You have already encountered <em>internal</em> project configuration files. The <code class="docutils literal notranslate"><span class="pre">CodingEventsAPI</span></code> we have been working with has an <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> file which contains various configuration properties. However, when dealing with secrets we want to distance this data even further from our project code. As a reminder, secrets are data required for applications to function, but the secrets need to be kept external to our project.</p>
<p>External configuration is the process of keeping configuration data outside of the source code of a project and loading the configuration values into the project at runtime. This keeps the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> separate from the project completely.</p>
<p>Using external configuration files has two major benefits:</p>
<ol class="arabic simple">
<li>Secrets are kept separate and safe from both the code and running application</li>
<li>An application can different configuration for different environments, such as different database connection strings for staging and production</li>
</ol>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">Separating the configurations from the rest of the source code has even more benefits, but these are the two ways in which we will explore external configurations throughout this course.</p>
</div>
<p>We will discuss application environments in the next article, but before then let’s discuss how we can manage secrets in .NET and Azure.</p>
</div>
</div>
<div class="section" id="id1">
<h3>6.1.1.2. Secrets Management<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p id="index-4">There are many different applications that handle secrets management, and while they have slightly different implementations they are loosely based on the same basic principles. Generally speaking, we refer to these services as <strong>secrets managers</strong>.</p>
<ul class="simple" id="index-5">
<li>A <strong>secrets store</strong> is a directory or location that houses secrets</li>
<li>Secrets are contained in a text file</li>
<li>Secrets are stored as strings consisting of key-value pairs</li>
<li>A secret’s key refers to the name of the secret</li>
<li>A secret’s value refers to the contents of the secret (a string or a more complex object of data like JSON)</li>
</ul>
<p>We have used two different environments for running our apps: locally on our personal machines and remotely via Azure. For local development environments we will use the <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">user-secrets</span></code> tool to manage our secrets. In remote environments we will use Azure Key Vault.</p>
</div>
</div>
<div class="section" id="secrets-managers">
<h2>6.1.2. Secrets Managers<a class="headerlink" href="#secrets-managers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dotnet-user-secrets">
<h3>6.1.2.1. <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">user-secrets</span></code><a class="headerlink" href="#dotnet-user-secrets" title="Permalink to this headline">¶</a></h3>
<p id="index-6"><code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">user-secrets</span></code> is an added module of the <code class="docutils literal notranslate"><span class="pre">dotnet</span></code> CLI. Like all <code class="docutils literal notranslate"><span class="pre">dotnet</span></code> commands, you can use the <code class="docutils literal notranslate"><span class="pre">--help</span></code> option to learn more. This tool is a <strong>local secrets manager</strong>.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">user-secrets</span></code>, <code class="docutils literal notranslate"><span class="pre">dotnet</span></code> creates a secrets store directory on your machine. When you <em>initialize</em> a secrets store in your project, your project configuration file (<code class="docutils literal notranslate"><span class="pre">.csproj</span></code>) will automatically be updated with its ID.</p>
<p>We can see this in action by creating a new temporary .NET project and printing out the <code class="docutils literal notranslate"><span class="pre">.csproj</span></code> file:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; dotnet new console -n example-dotnet-user-secret
&gt; Set-Location ./example-dotnet-user-secret/
&gt; Get-Content ./example-dotnet-user-secret.csproj

&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;

&lt;PropertyGroup&gt;
   &lt;OutputType&gt;Exe&lt;/OutputType&gt;
   &lt;TargetFramework&gt;netcoreapp3.1&lt;/TargetFramework&gt;
   &lt;RootNamespace&gt;example_dotnet_user_secret&lt;/RootNamespace&gt;
&lt;/PropertyGroup&gt;

&lt;/Project&gt;
</pre></div>
</div>
</div>
<p>This is the <code class="docutils literal notranslate"><span class="pre">.csproj</span></code> file for a standard .NET project. Let’s initialize a new secret store for this project using <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">user-secrets</span> <span class="pre">init</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; Set-Location ./example-dotnet-user-secret/
&gt; dotnet user-secrets init --id example-secret-store-id

Set UserSecretsId to &#39;example-secret-store-id&#39; for MSBuild project
&#39;/home/&lt;username&gt;/example-dotnet-user-secret/example-dotnet-user-secret.csproj&#39;.
</pre></div>
</div>
</div>
<p>This command did two things for us:</p>
<ol class="arabic simple">
<li>It created a new secret store, and</li>
<li>it amended the <code class="docutils literal notranslate"><span class="pre">.csproj</span></code> file to let our project know the ID of the secret store.</li>
</ol>
<p>We can view the changed <code class="docutils literal notranslate"><span class="pre">.csproj</span></code> file with:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; Set-Location ./example-dotnet-user-secret/
&gt; Get-Content ./example-dotnet-user-secret.csproj

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;
&lt;PropertyGroup&gt;
   &lt;OutputType&gt;Exe&lt;/OutputType&gt;
   &lt;TargetFramework&gt;netcoreapp3.1&lt;/TargetFramework&gt;
   &lt;RootNamespace&gt;example_dotnet_user_secret&lt;/RootNamespace&gt;
<span class="hll">   &lt;UserSecretsId&gt;example-secret-store-id&lt;/UserSecretsId&gt;
</span>&lt;/PropertyGroup&gt;
&lt;/Project&gt;
</pre></div>
</div>
</div>
<p>Now that our .NET project has an associated secret store we can add as many secrets as we want. They will be stored externally from our project source and loaded at runtime.</p>
<p>Let’s add a new secret:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Windows/PowerShell</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; Set-Location ./example-dotnet-user-secret
&gt; dotnet user-secrets set secret_name secret_value

Successfully saved secret_name = secret_value to the secret store.
</pre></div>
</div>
</div>
<p>Setting our first secret associated with this project and secret store will have created a new <code class="docutils literal notranslate"><span class="pre">secrets.json</span></code> file. It will look something like this:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;secret_name&quot;</span><span class="o">:</span> <span class="s2">&quot;secret_value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can safely discard this application since we will no longer be using it. In the following walkthrough we will get hands-on practice with both local <code class="docutils literal notranslate"><span class="pre">user-secrets</span></code> and the Azure Key Vault.</p>
</div>
<div class="section" id="azure-key-vault">
<h3>6.1.2.2. Azure Key Vault<a class="headerlink" href="#azure-key-vault" title="Permalink to this headline">¶</a></h3>
<p id="index-7">In our remote production environment we will be using Azure Key Vault to manage our secrets. The Azure Key Vault is a <strong>remote secrets manager</strong>. It behaves like <code class="docutils literal notranslate"><span class="pre">user-secrets</span></code> but is managed externally from your machine.</p>
<p>The following are the general steps of setting up a Key Vault. In the following walkthrough we will cover these steps in greater detail.</p>
<p>Starting in the Azure portal you will need to search for the Key Vault blade.</p>
<img alt="../../_images/keyvault-search.png" src="../../_images/keyvault-search.png" />
<p>Then from the home page you will need to click <em>Add</em>.</p>
<img alt="../../_images/keyvault-add.png" src="../../_images/keyvault-add.png" />
<p>Then fill out the form to create the Key Vault.</p>
<img alt="../../_images/keyvault-form.png" src="../../_images/keyvault-form.png" />
<p>This creates a new Key Vault with the specified parameters. By selecting this Key Vault you can add new secrets.</p>
<img alt="../../_images/keyvault-secrets.png" src="../../_images/keyvault-secrets.png" />
<p>Then by clicking <em>Add</em> again you fill out the form to create a new secret.</p>
<img alt="../../_images/keyvault-form-filled-out.png" src="../../_images/keyvault-form-filled-out.png" />
<p>We then see our newly created secret in Key Vault. (<em>Note:</em> The secret in this example has key <code class="docutils literal notranslate"><span class="pre">&quot;Name&quot;</span></code> and value <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, so while it may not be obvious at first glance, it is indeed in the table of secrets.)</p>
<img alt="../../_images/keyvault-secret-final.png" src="../../_images/keyvault-secret-final.png" />
</div>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="index.html"><span aria-hidden="true">&larr;</span> 6. Secrets Management &amp; Backing Services</a></li>
        
        
        <li class="next"><a href="application-environments.html">6.2. Application Environments <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/secrets-and-backing/secrets-management.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>